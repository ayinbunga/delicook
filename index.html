<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">

<title>DeliCook App</title>

<link rel="stylesheet" type="text/css" href="include/style.css">
<link href="jquery-mobile/jquery.mobile-1.0.min.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="sweetalert/sweetalert.css">
<!-- link rel="stylesheet" href="include/bootstrap.min.css" -->

<script src="jquery-mobile/jquery-1.6.4.min.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.0.min.js" type="text/javascript"></script>
<script src="sweetalert/sweetalert-dev.js"></script>
<!--
<script src="jquery-mobile/jquery.js"></script>
-->
<script src="jquery-mobile/slidereveal.js"></script>

<script>

//added some lines
 var db = null;
 var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	db.transaction(function(tx){
		//tx.executeSql('DROP TABLE IF EXISTS user');
		//tx.executeSql('DROP TABLE IF EXISTS userimage');
		//tx.executeSql('DROP TABLE IF EXISTS recipes');
		tx.executeSql('CREATE TABLE IF NOT EXISTS user(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, created unique, email, username UNIQUE, password)');
		tx.executeSql('CREATE TABLE IF NOT EXISTS recipes(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, username, title, recipe, recipe_img)');
	});

$('document').ready(function(){
		var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
		
	db.transaction(function(tx){
			tx.executeSql('SELECT * FROM user', [], querySuccess, errorCB);	
	});
	
	function querySuccess(tx, results){
			var len = results.rows.length;
				if(len > 0){
					
					console.log("Currently have "+len+" users registered");
					}
				
				else{
					console.log("No users registered yet");
					localStorage.setItem("username", "");
				}
				
		}
		function errorCB(err){
		 alert("Error" + err.code);
		}
	});

</script>

<script>

function checkSession() {

var username = localStorage.getItem('username');

if (username != ""){
	$.mobile.changePage( $("#profile"), "slide", true, true); 
}
else {
	$.mobile.changePage( $("#index"), "slide", true, true); 
}

}


</script>



</head> 
<body> 

<!--- Start of first page --->

<div data-role="page" id="first">
	
    <div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> </td> </tr>
    </table>
    </div>
    
    <div data-role="content" align="center">
    
    	<p>&nbsp;</p>
        <img src="images/icon/DeliCookTitle.png" width="300" height="120">
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <h2 onClick="checkSession()"> Tap to Enter </h2>
        <a href="#index"> <h2> index </h2> </a>
      	
    	
	</div>
</div>

<!--- End of first page --->

<!--- Start of index page --->

<div data-role="page" id="index">
	
    <div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> </td> </tr>
    </table>
    </div>
    
    <div data-role="content" align="center">
    
    	<p>&nbsp;</p>
        <img src="images/icon/DeliCookTitle.png" width="300" height="120">
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <button onClick="loginpage()">Login</button>
		<button onClick="newaccountpage()">New Account</button>
        
<script>

function loginpage() {
	$.mobile.changePage( $("#login"), "slide", true, true);
}

function newaccountpage() {
	$.mobile.changePage( $("#signup"), "slide", true, true);
}
</script>        
      	
    	
	</div>
</div>

<!--- End of index page --->



<!--- Start of login page --->

<div data-role="page" id="login">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> </td> </tr>
    </table>
    </div>
    
   <div data-role="content" align="center">
   <p>&nbsp;</p>
   
     	<img src="images/icon/DeliCookTitle.png" width="300" height="120">
       	<form name="loginform" runat="server">
        <div data-role="fieldcontain" align="center">

     	 <input type="text" name="loginusername" id="loginusername" placeholder="Username" required/>

      	</div>

    
   		<div data-role="fieldcontain" align="center">
      	  <input type="password" id="loginpassword" placeholder="Password" required/>
    	</div>
   
    	 <input type="button" id="loginbtn" value="Login">
         </form>
     
     <a href="#profile"> profile </a>
     
  </div>  
</div>

<!--- End of login page --->


<!--- Start of signup page --->

<div data-role="page" id="signup">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> <h2> Sign Up </h2></td> </tr>
    </table>
    </div>
    
   <div data-role="content" align="center">
    
    	<div data-role="fieldcontain" align="center">
      	 <input type="text" id="username" placeholder="Username" required/>
    	</div>

    
    	<div data-role="fieldcontain" align="center">
      	 <input type="text" id="email" placeholder="E-mail" required/>
      	</div>

    
    	<div data-role="fieldcontain" align="center">
      	 <input type="password" id="password" placeholder="Password" required/>
    	</div>

     	<div data-role="fieldcontain" align="center">
      	 <input type="password" id="cfm_password" placeholder="Confirm Password" required/>
    	</div>

     	<input name="signupbtn" type="button" id="signupbtn" value="Sign Up">
        
        
        <a href="#signup2"> Sign up 2 </a>
     
  </div>  
</div>

<!--- End of signup page --->


<!--- Start of signup2 page --->

<div data-role="page" id="signup2">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> <h2> Sign Up </h2></td> </tr>
    </table>
    </div>
    
    <div data-role="content" align="center">
	<div id="dropbox" class="media-drop-placeholder" style="width: 250px; height: 250px">
    
    <img id="profilepic" src="#" height="200px" width="200px" />
    
    <span class="media-drop-placeholder-title">Upload profile picture</span>

    </div>
    
    <br>
    <form id="form1" runat="server">
    <input type='file' id="imgInp" />
    </form>
    
 	<input type="button" id="uploadprofilepic" value="Register"> 
    
    <a href="#profile">Profile</a>
	

    <script>
	
	function readURL(input) {

    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#profilepic').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
}

	$("#imgInp").change(function(){
    		readURL(this);
	});
	</script>
   

	</div>
</div>

<!--- End of signup2 page --->


<!--- Start of profile page --->

<div data-role="page" id="profile">

	<div data-role="header">
    <table>
      <tr> <td rowspan="2"> <img src="#" id="pic" width="71px" height="68px"> </td> 
      </tr>
      <tr> <td rowspan="2"> <div id="p_usrname"> </div> </td></tr>
    </table>
    
    </div>
    
    <div id="menu-bar">
      <div class="handle">
        <span> <img src="images/icon/left arrow.png" width="46" height="44"> </span>
      </div>
      <h3> Menu <br/>
      </h3>
      <a href="#" onClick="addnew()">+  New Recipe</a>
      <a href="#">How to use</a>
      <a href="#people">People</a>
      <a href="#" onClick="logOutSession()">Log Out</a>
    </div>
    
    
  		<table width="100%" class="table" align="center">

		<tr>
		<td> <font size="+2" id="totalrecipe"></font> </td>
		<td> <font size="+2">69</font> </td>
		<td> <font size="+2">158</font> </td>
		<td> <font size="+2">3</font> </td>
		</tr>

		<tr>
		<td> recipes </td>
		<td> followers </td>
		<td> following </td>
		<td> groups </td>
		</tr>
		</table>
                
  	<div data-role="content" class="content" align="justify">
      <div id="alltherecipes" align="center"> </div>
      <div id="norecipes" align="center"> </div> 
           
  	</div>
  
    
    <script>
	function logOutSession() {
		
	swal({   
		title: "Log Out",
		text:"Are you sure?",     
		type: "warning",   
		showCancelButton: true,   
		confirmButtonColor: "#DD6B55",   
		confirmButtonText: "Yes",   
		closeOnConfirm: true }, 
		
		function(){   
			localStorage.setItem("username", "");
			$.mobile.changePage( $("#first"), "slide", true, true);
			window.location.reload(); 
		});

	}
	</script>
 
    
    <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<img src="images/icon/home icon.png" width="57" height="57">
  	</td>  
  	<td align="center">
  	<img src="images/icon/Contact-icon.png" width="57" height="57">
 	</td>
  	<td align="center">
  	<img src="images/icon/food_dining_icon.png" width="57" height="57">
  	</td>
  	<td align="center"> <a href="#people"> <img src="images/icon/people-icon.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div>

</div>

<!--- End of profile page --->

<!--- Start of addrecipe page --->

<div data-role="page" id="addrecipe">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> <div id="title"> </div> </td> </tr>
    </table>
    <img src="images/icon/logout icon 3.png" width="46" height="44"class="ui-btn-right" onClick="logOutSession()">
    </div>
	
    
   	
    
    
   <div data-role="content" align="center" class="content">	
   <!-- <input type="text" id="recipe_title" placeholder="Recipe Name"> -->
	<div id="dropbox" class="media-drop-placeholder" style="width: 300px; height: 100px">
    <img id="recipeimg" src="#" height="200px" width="300px"/>
    <span class="media-drop-placeholder-title">
    <form id="addrecipeform" runat="server">
    <input type='file' id="up_recipeimg" /></form></span>
    </div>
    <br>
    <textarea cols="40" rows="8" name="recipe" id="recipe" placeholder="Type in your recipe here.."></textarea>
    <input type="button" id="addrecipebutton" value="Submit">
    <br>
    
	</div>
    <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<img src="images/icon/home icon.png" width="57" height="57">
  	</td>  
  	<td align="center"> <a href="#profile">
  	<img src="images/icon/Contact-icon.png" width="57" height="57"> </a>
 	</td>
  	<td align="center">
  	<img src="images/icon/food_dining_icon.png" width="57" height="57">
  	</td>
  	<td align="center">  <img src="images/icon/people-icon.png" width="57" height="57"> 
  	</td>
  	</tr>
  	</table>
  	</div>
    
     <script>
	
	function readURL2(input) {

    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#recipeimg').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
}

	$("#up_recipeimg").change(function(){
    		readURL2(this);
	});
	
	</script>
</div>

<!--- End of addrecipe page --->


<!--- Start of viewrecipe page --->

<div data-role="page" id="viewrecipe">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"><h2 id="recipe_title2"></h2> </td> </tr>
    </table>
    <img src="images/icon/logout icon 3.png" width="46" height="44"class="ui-btn-right" onClick="logOutSession()">
    </div>
    
   <div data-role="content" align="center" class="content">
   <br>
   <img id="recipeimg2" src="#" height="250" width="300">
   <br>
   <div id="recipe2"></div>
   </div>
    	
    <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<img src="images/icon/home icon.png" width="57" height="57">
  	</td>  
  	<td align="center">
  	<img src="images/icon/Contact-icon.png" width="57" height="57">
 	</td>
  	<td align="center">
  	<img src="images/icon/food_dining_icon.png" width="57" height="57">
  	</td>
  	<td align="center"> <a href="#people"> <img src="images/icon/people-icon.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div>
      
</div>

<!--- End of viewrecipe page --->

<!--- Start of people page --->

<div data-role="page" id="people">
	
    <div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> </td> </tr>
    </table>
    <img src="images/icon/logout icon 3.png" width="46" height="44"class="ui-btn-right" onClick="logOutSession()">
    </div>
    
    
    <div data-role="content" align="center">
    <table id="alltheusers" class="table">
    </table>  	
    	
	</div>
    
    <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<img src="images/icon/home icon.png" width="57" height="57">
  	</td>  
  	<td align="center">
  	<img src="images/icon/Contact-icon.png" width="57" height="57">
 	</td>
  	<td align="center">
  	<img src="images/icon/food_dining_icon.png" width="57" height="57">
  	</td>
  	<td align="center"> <a href="#people"> <img src="images/icon/people-icon.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div>
    
</div>


<!--- End of people page --->


<!--- Start of viewuser page --->

<div data-role="page" id="viewuser">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="#" id="viewuserimage" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> <h2 id="viewusername"></h2> </td> </tr>
    </table>
    <img src="images/icon/logout icon 3.png" width="46" height="44"class="ui-btn-right" onClick="logOutSession()">
    </div>
    
    <table width="100%" class="table" align="center">

		<tr>
		<td> <font size="+2" id="totalrecipe2"></font> </td>
		<td> <font size="+2">69</font> </td>
		<td> <font size="+2">158</font> </td>
		<td> <font size="+2">3</font> </td>
		</tr>

		<tr>
		<td> recipes </td>
		<td> followers </td>
		<td> following </td>
		<td> groups </td>
		</tr>
		</table>
    
   <div data-role="content" align="justify" class="content">
    <div id="viewalluserrecipes" align="center"></div>
    <div id="user_norecipes" align="center"> </div> 
     
  </div> 
  
  <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<img src="images/icon/home icon.png" width="57" height="57">
  	</td>  
  	<td align="center">
  	<img src="images/icon/Contact-icon.png" width="57" height="57">
 	</td>
  	<td align="center">
  	<img src="images/icon/food_dining_icon.png" width="57" height="57">
  	</td>
  	<td align="center"> <a href="#people"> <img src="images/icon/people-icon.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div> 
</div>

<!--- End of viewuser page --->



<script>

//menubar option panel

$("#menu-bar a").click(function(){
          var id = $(this).attr("href").substring(1);
          $("html, body").animate({ scrollTop: $("#"+id).offset().top }, 1000, function(){
            $("#menu-bar").slideReveal("hide");
          });
        });

        var slider = $("#menu-bar").slideReveal({
          // width: 100,
          push: false,
          position: "right",
          // speed: 600,
          trigger: $(".handle"),
          autoEscape: false,
          shown: function(obj){
            obj.find(".handle").html('<span> <img src="images/icon/right arrow.png" width="46" height="44"> </span>');
            obj.addClass("left-shadow-overlay");
          },
          hidden: function(obj){
            obj.find(".handle").html('<span> <img src="images/icon/left arrow.png" width="46" height="44"> </span>');
            obj.removeClass("left-shadow-overlay");
          }
});

$("#signupbtn").click(function(){
	var email = $("#email").val();
	var password = $("#password").val();
	var username = $("#username").val();
	var cfm_passwd = $("#cfm_password").val();
	var created = $.now();
	var NULL = "";
	
	if ((email != NULL) && (username != NULL) && (password != NULL) && (cfm_passwd != NULL)) {
			if(password == cfm_passwd){
					function populateDB(tx){
						tx.executeSql('CREATE TABLE IF NOT EXISTS user(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, created unique, email, username UNIQUE, password)');
						tx.executeSql('INSERT INTO user(created, email, username, password) VALUES(?, ?, ?, ?)', [created, email, username, password]);
					}
					function errorCB(err){
						alert("error");
					}
		
					function successCB(){
						$.mobile.changePage( $("#signup2"), "slide", true, true);
					}
				
					var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
					db.transaction(populateDB,errorCB,successCB);
		
				}
		 			else {
						swal("Invalid input!", "Wrong password confirmation!", "warning") }
		 		}
					else {
						swal("Invalid input!", "Please fill up all the fields!", "warning") }
				
		
			$("#uploadprofilepic").click(function(){
			var profilepic =  $('#profilepic').attr('src');
		
			function populateDB(tx){
				tx.executeSql('CREATE TABLE IF NOT EXISTS userimage(username PRIMARY KEY, image)');
				tx.executeSql('INSERT INTO userimage(image,username) VALUES(?,?)', [profilepic, username]);
			}
		
			function errorCB(err){
				alert("error");
			}
			function successCB(){
				swal("Welcome!", "You are now a part of Delicook community! You may start by logging in!", "success")
				$.mobile.changePage( $("#login"), "slide", true, true);
			}
		
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
			db.transaction(populateDB,errorCB,successCB);
		
});
		
		
});


$("#loginbtn").click(function(){
	var username = $("#loginusername").val();
	var password = $("#loginpassword").val();
	var NULL = "";
	
	localStorage.setItem("username", username);

	if ((username != NULL) && (password != NULL)) {
		
		$('document').ready(function(){
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM user WHERE username=? and password=?', [username,password], querySuccess, errorCB);
			});
			
			function querySuccess(tx, results){
				var len = results.rows.length;
					if(len > 0){
						$.mobile.changePage( $("#profile"), "slide", true, true);
						window.location.reload();
						  }
				else {
					swal("Invalid input!", "Wrong username or password", "warning") }
			}
		
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});
	}
	else { swal("Invalid input!", "Please fill up all the fields!", "warning") }
	
});

//displaying the profile image
	
$('document').ready(function(){
			var username = localStorage.getItem('username');
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM userimage WHERE username=?', [username], querySuccess, errorCB);
			});
			
			function querySuccess(tx, results){
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						var url = results.rows.item(i).image;
						$('#pic').attr('src', url);
						$("#p_usrname").append("<h2>"+results.rows.item(i).username)+"</h2>";
					}
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});

//adding new recipe

function addnew(){
	var username = localStorage.getItem('username');
	$.mobile.changePage( $("#addrecipe"), "slide", true, true);
	swal({  title: "New recipe",
			text: "Recipe name:",   
			type: "input",   showCancelButton: true,   
			closeOnConfirm: false,   animation: "slide-from-top",   
			inputPlaceholder: "Your recipe name" }, 
			
			function(inputValue){   
				if (inputValue === false) return false;      
					if (inputValue === "") {     
					swal.showInputError("Your recipe must have a name");     
					return false   }      
					swal("Nice!", "Your new recipe is " + inputValue, "success");
					$("#title").append("<h2>"+inputValue+"</h2>");
					
					$("#addrecipebutton").click(function(){
						var recipe = $("#recipe").val();
						var recipe_img =  $('#recipeimg').attr('src');
						var NULL = "";
							if (recipe != NULL) {
								function populateDB(tx){
									tx.executeSql('CREATE TABLE IF NOT EXISTS recipes(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, username, title, recipe, recipe_img)');
									tx.executeSql('INSERT INTO recipes(username, title, recipe, recipe_img) VALUES(?, ?, ?, ?)', [username, inputValue, recipe, recipe_img]);
					}
					function errorCB(err){
						alert("error");
					}
		
					function successCB(){
						swal({   
								title: "Sweet!",   
								text: "Thanks for sharing us your recipe",   
								imageUrl: "images/thumbs-up.jpg",     
								confirmButtonColor: "#FF6820",   
								confirmButtonText: "OK",   
								closeOnConfirm: false }, 
								
								function(){   
								$.mobile.changePage( $("#profile"), "slide", true, true); 
								window.location.reload(); });
						
						
					}
					
				
					var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
					db.transaction(populateDB,errorCB,successCB);
		
				}
				else {
						swal("Invalid input!", "Please fill up all the fields!", "warning") }
					
		
});
					
	});
}


//diplaying all uploaded recipes

$('document').ready(function(){
			var username = localStorage.getItem('username');
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM recipes WHERE username=?', [username], querySuccess, errorCB);
			});
			
			function querySuccess(tx, results){
				var len = results.rows.length;
				if(len > 0){
					$("#totalrecipe").append(len);
					for(i = 0; i < len; i++){
						$("#alltherecipes").append("<img onClick='ViewRecipe(this)' src='"+results.rows.item(i).recipe_img+"' height='160px' width='160px'>");
					}
				}
				else {
					$("#totalrecipe").append(len);
					$("#norecipes").append("<br><br><font color=#A4A4A4> No recipes uploaded yet. </font>");
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});
		
//view full recipe
		
function ViewRecipe(image) {
	
	var username = localStorage.getItem('username');
	var url = image.src;
	
	var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
	db.transaction(function(tx){
				tx.executeSql('SELECT * FROM recipes WHERE username=? AND recipe_img=?', [username,url], querySuccess, errorCB);
			});
	
	$.mobile.changePage( $("#viewrecipe"), "slide", true, true);
	
	function querySuccess(tx, results){
				
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						document.getElementById("recipe_title2").innerHTML = results.rows.item(i).title;
						$('#recipeimg2').attr('src', url);
						document.getElementById("recipe2").innerHTML = results.rows.item(i).recipe;
						
					}
				}
				else{
					
				}
	}
			
	function errorCB(err){
		 		alert("Error" + err.code);	}

}

//displaying all users
	
$('document').ready(function(){
			var username = localStorage.getItem('username');
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM userimage', [], querySuccess, errorCB);
			});
			
			
			function querySuccess(tx, results){
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						var current_user = results.rows.item(i).username;
						if( current_user != username ) {
						$("#alltheusers").append("<tr><td><img onClick='ViewUser(this)' src='"+results.rows.item(i).image+"' height='70px' width='70px'></td><td width='100' align='center'><h2>"+results.rows.item(i).username+"</h2></td><td width='100' align='right'><a href='#' data-role='button' data-icon='plus' data-iconpos='notext'>Button</a></td></tr>"); }
					}
				
				}
				else {
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});

	
//view user profile
		
function ViewUser(image) {
	
	$('.users').click(function(e) {
    var index = $('.users').index(this) + 1;
    
    var obj = {
        index: index
    };
    
    window.history.pushState(obj, $(this).text(), "/" + index);
    
    e.preventDefault();
	});
	
	
	$(window).bind("popstate", function(e) {
    	var state = e.originalEvent.state;
    
    	if(state) {
        	window.location.reload();
    	} else {
        	//window.location.reload();
    }
	});
	
	
	$.mobile.changePage( $("#viewuser"), "slide", true, true);
	
	var url = image.src;
	
	var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
	db.transaction(function(tx){
				tx.executeSql('SELECT * FROM userimage WHERE image=?', [url], querySuccess, errorCB);
			});
	
	
	
	function querySuccess(tx, results){
				
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						var current_user = results.rows.item(i).username;
						localStorage.setItem("current_user", current_user);
						var view_current_user = localStorage.getItem('current_user');
						document.getElementById("viewusername").innerHTML = view_current_user;
						$('#viewuserimage').attr('src', url);
						
					}
					
				//view all recipes for current user viewed
				
				db.transaction(function(tx){
							tx.executeSql('SELECT * FROM recipes WHERE username=?', [view_current_user], querySuccess2, errorCB2);
						});
			
			function querySuccess2(tx, results){
				var len = results.rows.length;
				if(len > 0){
					document.getElementById("totalrecipe2").innerHTML = len
					for(i = 0; i < len; i++){
						$("#viewalluserrecipes").append("<img onClick='ViewUserRecipe(this)' src='"+results.rows.item(i).recipe_img+"' height='160px' width='160px'>");
					}
					
				}
				else {
					document.getElementById("totalrecipe2").innerHTML = len
					document.getElementById("user_norecipes").innerHTML = "<br><br><font color=#A4A4A4> No recipes uploaded yet. </font>"
				}
		}
			function errorCB2(err){
		 		alert("Error" + err.code);	}
				
				}
				else{
					
				}
	}
			
	function errorCB(err){
		 		alert("Error" + err.code);	}

}	


//view user full recipe
		
function ViewUserRecipe(image) {
	
	var username = localStorage.getItem('current_user');
	var url = image.src;
	
	var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
	db.transaction(function(tx){
				tx.executeSql('SELECT * FROM recipes WHERE username=? AND recipe_img=?', [username,url], querySuccess, errorCB);
			});
	
	$.mobile.changePage( $("#viewrecipe"), "slide", true, true);
	
	function querySuccess(tx, results){
				
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						document.getElementById("recipe_title2").innerHTML = results.rows.item(i).title;
						$('#recipeimg2').attr('src', url);
						document.getElementById("recipe2").innerHTML = results.rows.item(i).recipe;
						
					}
				}
				else{
					
				}
	}
			
	function errorCB(err){
		 		alert("Error" + err.code);	}

}





</script>


</body>
</html>
