<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<title>DeliCook App</title>

<link rel="stylesheet" type="text/css" href="include/style.css">
<link href="jquery-mobile/jquery.mobile-1.0.min.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="sweetalert/sweetalert.css">

<script src="jquery-mobile/jquery-1.6.4.min.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.0.min.js" type="text/javascript"></script>
<script src="sweetalert/sweetalert-dev.js"></script>

<script>
//added some lines
 var db = null;
 
 var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	db.transaction(function(tx){
		//tx.executeSql('DROP TABLE IF EXISTS user');
		//tx.executeSql('DROP TABLE IF EXISTS userimage');
		tx.executeSql('CREATE TABLE IF NOT EXISTS user(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, created unique, email, username UNIQUE, password)');
	});

	$('document').ready(function(){
		var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
		
	db.transaction(function(tx){
			tx.executeSql('SELECT * FROM user', [], querySuccess, errorCB);	
	});
	
	function querySuccess(tx, results){
			var len = results.rows.length;
				if(len > 0){
					
					console.log("Currently have "+len+" users registered");
					}
				
				else{
					console.log("No users registered yet");
				}
				
		}
		function errorCB(err){
		 alert("Error" + err.code);
		}
	});

</script>



</head> 
<body> 

<!--- Start of index page --->

<div data-role="page" id="index">
	
    <div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> </td> </tr>
    </table>
    </div>
    
    <div data-role="content" align="center">
    
    	<p>&nbsp;</p>
        <img src="images/icon/DeliCookTitle.png" width="300" height="120">
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <a href="#login"> <button>Login</button> </a>
		<a href="#signup"> <button>New Account</button> </a>
      	
    	
	</div>
</div>

<!--- End of index page --->



<!--- Start of login page --->

<div data-role="page" id="login">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> </td> </tr>
    </table>
    </div>
    
   <div data-role="content" align="center">
   <p>&nbsp;</p>
   
     	<img src="images/icon/DeliCookTitle.png" width="300" height="120">
       	
        <div data-role="fieldcontain" align="center">
     	 <input type="text" id="loginusername" placeholder="E-mail" required/>
      	</div>

    
   		<div data-role="fieldcontain" align="center">
      	  <input type="password" id="loginpassword" placeholder="Password" required/>
    	</div>
   
    	 <input type="button" id="loginbtn" value="Login">
     
     <a href="#profile"> profile </a>
  </div>  
</div>

<!--- End of login page --->


<!--- Start of signup page --->

<div data-role="page" id="signup">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> <h2> Sign Up </h2></td> </tr>
    </table>
    </div>
    
   <div data-role="content" align="center">
    
    	<div data-role="fieldcontain" align="center">
      	 <input type="text" id="username" placeholder="Username" required/>
    	</div>

    
    	<div data-role="fieldcontain" align="center">
      	 <input type="text" id="email" placeholder="E-mail" required/>
      	</div>

    
    	<div data-role="fieldcontain" align="center">
      	 <input type="password" id="password" placeholder="Password" required/>
    	</div>

     	<div data-role="fieldcontain" align="center">
      	 <input type="password" id="cfm_password" placeholder="Confirm Password" required/>
    	</div>

     	<input name="signupbtn" type="button" id="signupbtn" value="Sign Up">
        
        
        <a href="#signup2"> Sign up 2 </a>
     
  </div>  
</div>

<!--- End of signup page --->


<!--- Start of signup2 page --->

<div data-role="page" id="signup2">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> <h2> Sign Up </h2></td> </tr>
    </table>
    </div>
    
    <div data-role="content" align="center">
	<div id="dropbox" class="media-drop-placeholder" style="width: 250px; height: 250px">
    
    <img id="profilepic" src="#" height="200px" width="200px" />
    
    <span class="media-drop-placeholder-title">Upload profile picture</span>

    </div>
    
    <br>
    <form id="form1" runat="server">
    <input type='file' id="imgInp" />
    </form>
    
 	<input type="button" id="uploadprofilepic" value="Register"> 
    
    <a href="#profile">Profile</a>
	

    <script>
	
	function readURL(input) {

    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#profilepic').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
}
	</script>
   

	</div>
</div>

<!--- End of signup2 page --->


<!--- Start of profile page --->

<div data-role="page" id="profile">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="#" id="pic" width="71px" height="68px"> </td> 
    </tr>
    <tr> <td rowspan="2"> <div id="p_usrname"> </div> </td> </tr>
    </table>
    </div>
    
	<div>
    	<div>
		<table width="100%" class="table" align="center">

		<tr>
		<td> <font size="+2">14</font> </td>
		<td> <font size="+2">69</font> </td>
		<td> <font size="+2">158</font> </td>
		<td> <font size="+2">3</font> </td>
		</tr>

		<tr>
		<td> recipes </td>
		<td> followers </td>
		<td> following </td>
		<td> groups </td>
		</tr>
		</table>
	</div>
  
  
  	<div data-role="content" class="content" align="justify">
    
  	</div>

	</div>
</div>

<!--- End of profile page --->

<table width="200" border="1">
  <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
</table>



<script>

$("#signupbtn").click(function(){
	var email = $("#email").val();
	var password = $("#password").val();
	var username = $("#username").val();
	var cfm_passwd = $("#cfm_password").val();
	var created = $.now();
	var NULL = "";
	
	if ((email != NULL) && (username != NULL) && (password != NULL) && (cfm_passwd != NULL)) {
			if(password == cfm_passwd){
					function populateDB(tx){
						tx.executeSql('CREATE TABLE IF NOT EXISTS user(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, created unique, email, username UNIQUE, password)');
						tx.executeSql('INSERT INTO user(created, email, username, password) VALUES(?, ?, ?, ?)', [created, email, username, password]);
					}
					function errorCB(err){
						alert("error");
					}
		
					function successCB(){
						$.mobile.changePage( $("#signup2"), "slide", true, true);
					}
				
					var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
					db.transaction(populateDB,errorCB,successCB);
		
				}
		 			else {
						swal("Invalid input!", "Wrong password confirmation!", "warning") }
		 		}
					else {
						swal("Invalid input!", "Please fill up all the fields!", "warning") }
				
		
			
		$("#imgInp").change(function(){
    		readURL(this);
			$("#uploadprofilepic").click(function(){
			var profilepic =  $('#profilepic').attr('src');
		
			function populateDB(tx){
				tx.executeSql('CREATE TABLE IF NOT EXISTS userimage(username PRIMARY KEY, image)');
				tx.executeSql('INSERT INTO userimage(image,username) VALUES(?,?)', [profilepic, username]);
			}
		
			function errorCB(err){
				alert("error");
			}
			function successCB(){
				swal("Welcome!", "You are now a part of Delicook community! You may start by logging in!", "success")
				$.mobile.changePage( $("#login"), "slide", true, true);
			}
		
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
			db.transaction(populateDB,errorCB,successCB);
		
	});
});
		
		
});
	
	
$("#loginbtn").click(function(){
	var username = $("#loginusername").val();
	var password = $("#loginpassword").val();
	var NULL = "";

	if ((username != NULL) && (password != NULL)) {
		
		$('document').ready(function(){
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM user WHERE username=? and password=?', [username,password], querySuccess, errorCB);
			});
			
			function querySuccess(tx, results){
				var len = results.rows.length;
					if(len > 0){
						$.mobile.changePage( $("#profile"), "slide", true, true); }
				else {
					swal("Invalid input!", "Wrong username or password", "warning") }
			}
		
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});
	}
	else { swal("Invalid input!", "Please fill up all the fields!", "warning") }
	
	//displaying the profile image
	
	$('document').ready(function(){
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM userimage WHERE username=?', [username], querySuccess, errorCB);
			});
			
			function querySuccess(tx, results){
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						var url = results.rows.item(i).image;
						$('#pic').attr('src', url);
						$("#p_usrname").append("<h2>"+results.rows.item(i).username)+"</h2>";
					}
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});

});
</script>
</body>
</html>
