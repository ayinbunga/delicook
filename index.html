<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">

<title>DeliCook App</title>

<link rel="stylesheet" type="text/css" href="include/style.css">
<link href="jquery-mobile/jquery.mobile-1.0.min.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="sweetalert/sweetalert.css">
<!-- link rel="stylesheet" href="include/bootstrap.min.css" -->

<script src="jquery-mobile/jquery-1.6.4.min.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.0.min.js" type="text/javascript"></script>
<script src="sweetalert/sweetalert-dev.js"></script>
<!--
<script src="jquery-mobile/jquery.js"></script>
-->
<script src="jquery-mobile/slidereveal.js"></script>

<script>

//added some lines
 var db = null;
 var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	db.transaction(function(tx){
		//tx.executeSql('DROP TABLE IF EXISTS user');
		//tx.executeSql('DROP TABLE IF EXISTS userimage');
		//tx.executeSql('DROP TABLE IF EXISTS recipes');
		//tx.executeSql('DROP TABLE IF EXISTS tips');
		tx.executeSql('CREATE TABLE IF NOT EXISTS user(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, created unique, email, username UNIQUE, password)');
		tx.executeSql('CREATE TABLE IF NOT EXISTS recipes(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, username, title, recipe, recipe_img, timestamp)');
		tx.executeSql('CREATE TABLE IF NOT EXISTS tips(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, username, title, content, timestamp, category)');
	});

$('document').ready(function(){
		var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
		
	db.transaction(function(tx){
			tx.executeSql('SELECT * FROM user', [], querySuccess, errorCB);	
	});
	
	function querySuccess(tx, results){
			var len = results.rows.length;
				if(len > 0){
					
					console.log("Currently have "+len+" users registered");
					}
				
				else{
					console.log("No users registered yet");
					localStorage.setItem("username", "");
				}
				
		}
		function errorCB(err){
		 alert("Error" + err.code);
		}
	});

</script>

<script>

function checkSession() {

var username = localStorage.getItem('username');

if (username != ""){
	$.mobile.changePage( $("#profile"), "slide", true, true); 
}
else {
	$.mobile.changePage( $("#index"), "slide", true, true); 
}

}


</script>



</head> 
<body>

<!-- div id="loading">
<img id="loading-image" src="jquery-mobile/images/ajax-loader.gif" alt="Loading..." />
</div --> 
 

<!--- Start of first page --->

<div data-role="page" id="first">
	
    <div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> </td> </tr>
    </table>
    </div>
    
    <div data-role="content" align="center">
    
    	<p>&nbsp;</p>
        <img src="images/icon/DeliCookTitle.png" width="300" height="120">
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <h2 onClick="checkSession()"> Tap to Enter </h2>
        <!-- a href="#index"> <h2> index </h2> </a -->
      	
    	
	</div>
</div>

<!--- End of first page --->

<!--- Start of index page --->

<div data-role="page" id="index">
	
    <div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> </td> </tr>
    </table>
    </div>
    
    <div data-role="content" align="center">
    
    	<p>&nbsp;</p>
        <img src="images/icon/DeliCookTitle.png" width="300" height="120">
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <button onClick="loginpage()">Login</button>
		<button onClick="newaccountpage()">New Account</button>
        
<script>

function loginpage() {
	$.mobile.changePage( $("#login"), "slide", true, true);
}

function newaccountpage() {
	$.mobile.changePage( $("#signup"), "slide", true, true);
}
</script>        
      	
    	
	</div>
</div>

<!--- End of index page --->



<!--- Start of login page --->

<div data-role="page" id="login">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> </td> </tr>
    </table>
    </div>
    
   <div data-role="content" align="center">
   <p>&nbsp;</p>
   
     	<img src="images/icon/DeliCookTitle.png" width="300" height="120">
       	<form name="loginform" runat="server">
        <div data-role="fieldcontain" align="center">

     	 <input type="text" name="loginusername" id="loginusername" placeholder="Username" required/>

      	</div>

    
   		<div data-role="fieldcontain" align="center">
      	  <input type="password" id="loginpassword" placeholder="Password" required/>
    	</div>
   
    	 <input type="button" id="loginbtn" value="Login">
         </form>
     
     <!-- a href="#profile"> profile </a -->
     
  </div>  
</div>

<!--- End of login page --->


<!--- Start of signup page --->

<div data-role="page" id="signup">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> <h2> Sign Up </h2></td> </tr>
    </table>
    </div>
    
   <div data-role="content" align="center">
    
    	<div data-role="fieldcontain" align="center">
      	 <input type="text" id="username" placeholder="Username" required/>
    	</div>

    
    	<div data-role="fieldcontain" align="center">
      	 <input type="text" id="email" placeholder="E-mail" required/>
      	</div>

    
    	<div data-role="fieldcontain" align="center">
      	 <input type="password" id="password" placeholder="Password" required/>
    	</div>

     	<div data-role="fieldcontain" align="center">
      	 <input type="password" id="cfm_password" placeholder="Confirm Password" required/>
    	</div>

     	<input name="signupbtn" type="button" id="signupbtn" value="Sign Up">
        
        
        <!-- a href="#signup2"> Sign up 2 </a -->
     
  </div>  
</div>

<!--- End of signup page --->


<!--- Start of signup2 page --->

<div data-role="page" id="signup2">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> <h2> Sign Up </h2></td> </tr>
    </table>
    </div>
    
    <div data-role="content" align="center">
	<div id="dropbox" class="media-drop-placeholder" style="width: 300px; height: 250px">
    <span class="media-drop-placeholder-title">Upload profile picture</span>
    <br>
    <img id="profilepic" src="images/icon/Contact-icon 3.png" height="250px" width="250px" />
    
    <span class="media-drop-placeholder-title"> <form id="form1" runat="server">
    <input type='file' id="imgInp" />
    </form></span>

    </div>
    
    <br>
    
 	<input type="button" id="uploadprofilepic" value="Register"> 
    
    <!-- a href="#profile">Profile</a -->
	

    <script>
	
	function readURL(input) {

    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#profilepic').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
}

	$("#imgInp").change(function(){
    		readURL(this);
	});
	
	/*$('#profilepic').preload({
    placeholder:'images/icon/Final logo DeliCook.JPG',
    notFound:''
});*/
	</script>
   

	</div>
</div>

<!--- End of signup2 page --->


<!--- Start of profile page --->

<div data-role="page" id="profile">

	<div data-role="header">
    <table>
      <tr> <td rowspan="2"> <img src="#" id="pic" width="71px" height="68px"> </td> 
      </tr>
      <tr> <td rowspan="2"> <div id="p_usrname"> </div> </td></tr>
    </table>
    
    </div>
    
    <div id="menu-bar">
      <div class="handle">
        <span> <img src="images/icon/left arrow.png" width="46" height="44"> </span>
      </div>
      <h3> Menu <br/>
      </h3>
      <a href="#" onClick="addnew()">+  New Recipe</a>
      <a href="#">How to use</a>
      <a href="#people">People</a>
      <a href="#" onClick="logOutSession()">Log Out</a>
    </div>
    
    
  		<table width="100%" class="table" align="center">

		<tr>
		<td> <font size="+2" id="totalrecipe"></font> </td>
		<td> <font size="+2">69</font> </td>
		<td> <font size="+2">158</font> </td>
		<td> <font size="+2">3</font> </td>
		</tr>

		<tr>
		<td> recipes </td>
		<td> followers </td>
		<td> following </td>
		<td> groups </td>
		</tr>
		</table>
                
  	<div data-role="content" class="content" align="justify">
      <div id="alltherecipes" align="justify"> </div>
      <div id="norecipes" align="center"> </div> 
           
  	</div>
  
    
    <script>
	function logOutSession() {
		
	swal({   
		title: "Log Out",
		text:"Are you sure?",     
		type: "warning",   
		showCancelButton: true,   
		confirmButtonColor: "#DD6B55",   
		confirmButtonText: "Yes",   
		closeOnConfirm: true }, 
		
		function(){   
			localStorage.setItem("username", "");
			$.mobile.changePage( $("#first"), "slide", true, true);
			window.location.reload(); 
		});

	}
	</script>
 
    
    <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<a href="#home"> <img src="images/icon/home icon 2.png" width="57" height="57"> </a>
  	</td>  
  	<td align="center">
  	<a href="#"> <img src="images/icon/Contact-icon.png" width="57" height="57"> </a>
 	</td>
  	<td align="center">
  	<a href="#tips"> <img src="images/icon/food_dining_icon 2.png" width="57" height="57"> </a>
  	</td>
  	<td align="center"> 
    <a href="#explore"> <img src="images/icon/search button 2.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div>

</div>

<!--- End of profile page --->

<!--- Start of addrecipe page --->

<div data-role="page" id="addrecipe">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> <div id="title"> </div> </td> </tr>
    </table>
    <img src="images/icon/logout icon 4.png" width="46" height="44"class="ui-btn-right" onClick="logOutSession()">
    </div>
	
    
   	
    
    
   <div data-role="content" align="center" class="content">	
	<div id="dropbox" class="media-drop-placeholder" style="width: 300px; height: 100px">
    <img id="recipeimg" src="#" height="200px" width="300px"/>
    <span class="media-drop-placeholder-title">
    <form id="addrecipeform" runat="server">
    <input type='file' id="up_recipeimg" /></form></span>
    </div>
    <br>
    <textarea cols="40" rows="8" name="recipe" id="recipe" placeholder="Type in your recipe here.."></textarea>
    <input type="button" id="addrecipebutton" value="Submit">
    <br>
    
	</div>
    
     <script>
	
	function readURL2(input) {

    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#recipeimg').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
}

	$("#up_recipeimg").change(function(){
    		readURL2(this);
	});
	
	</script>
</div>

<!--- End of addrecipe page --->


<!--- Start of viewrecipe page --->

<div data-role="page" id="viewrecipe">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"><font size="+2" id="recipe_title2"></font> <font size="-1" id="cook"></font> </td> </tr>
    </table>
    <img src="images/icon/logout icon 4.png" width="46" height="44"class="ui-btn-right" onClick="logOutSession()">
    </div>
    
   <div data-role="content" align="center" class="content">
   <br>
   <img id="recipeimg2" src="#" height="250" width="300">
   <br>
   <div id="recipe2"></div>
   </div>
    	
    <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<a href="#home"> <img src="images/icon/home icon 2.png" width="57" height="57"> </a>
  	</td>  
  	<td align="center">
  	<a href="#profile"> <img src="images/icon/Contact-icon.png" width="57" height="57"> </a>
 	</td>
  	<td align="center">
  	<a href="#tips"> <img src="images/icon/food_dining_icon 2.png" width="57" height="57"> </a>
  	</td>
  	<td align="center"> 
    <a href="#explore"> <img src="images/icon/search button 2.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div>
      
</div>

<!--- End of viewrecipe page --->

<!--- Start of people page --->

<div data-role="page" id="people">
	
    <div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"><h2> People </h2> </td> </tr>
    </table>
    <img src="images/icon/logout icon 4.png" width="46" height="44"class="ui-btn-right" onClick="logOutSession()">
    </div>
    
    
    <div data-role="content" align="center">
    <table id="alltheusers" class="table">
    </table>  	
    	
	</div>
    
    <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<a href="#home"> <img src="images/icon/home icon 2.png" width="57" height="57"> </a>
  	</td>  
  	<td align="center">
  	<a href="#profile"> <img src="images/icon/Contact-icon.png" width="57" height="57"> </a>
 	</td>
  	<td align="center">
  	<a href="#tips"> <img src="images/icon/food_dining_icon 2.png" width="57" height="57"> </a>
  	</td>
  	<td align="center"> 
    <a href="#explore"> <img src="images/icon/search button 2.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div>
    
</div>


<!--- End of people page --->


<!--- Start of viewuser page --->

<div data-role="page" id="viewuser">

	<div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="#" id="viewuserimage" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"> <h2 id="viewusername"></h2> </td> </tr>
    </table>
    <img src="images/icon/logout icon 4.png" width="46" height="44"class="ui-btn-right" onClick="logOutSession()">
    </div>
    
    <table width="100%" class="table" align="center">

		<tr>
		<td> <font size="+2" id="totalrecipe2"></font> </td>
		<td> <font size="+2">69</font> </td>
		<td> <font size="+2">158</font> </td>
		<td> <font size="+2">3</font> </td>
		</tr>

		<tr>
		<td> recipes </td>
		<td> followers </td>
		<td> following </td>
		<td> groups </td>
		</tr>
		</table>
    
   <div data-role="content" align="justify" class="content">
    <div id="viewalluserrecipes" align="justify"></div>
    <div id="user_norecipes" align="center"> </div> 
     
  </div> 
  
  <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<a href="#home"> <img src="images/icon/home icon 2.png" width="57" height="57"> </a>
  	</td>  
  	<td align="center">
  	<a href="#profile"> <img src="images/icon/Contact-icon.png" width="57" height="57"> </a>
 	</td>
  	<td align="center">
  	<a href="#tips"> <img src="images/icon/food_dining_icon 2.png" width="57" height="57"> </a>
  	</td>
  	<td align="center"> 
    <a href="#explore"> <img src="images/icon/search button 2.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div>
</div>

<!--- End of viewuser page --->


<!--- Start of tips page --->

<div data-role="page" id="tips">
	
    <div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"><h2> Tips </h2> </td> </tr>
    </table>
    <img src="images/icon/logout icon 4.png" width="46" height="44"class="ui-btn-right" onClick="logOutSession()">
    </div>
    
    
    <div data-role="content" align="center">
    <font size="+1" color="#999999">Choose category of cooking tips you want to view </font>
    <br>
    <table>
    <tr>
    <td colspan="3"></td>
    </tr>
    <tr>
    <td><img src="images/icon/daging.PNG" width="95" height="95" id="beef"></td>
    <td><img src="images/icon/ayam.PNG" width="95" height="95" id="chicken"></td>
    <td><img src="images/icon/ikan.PNG" width="95" height="95" id="fish"></td>
    </tr>
    <tr>
    <td><img src="images/icon/ketam.PNG" width="95" height="95" id="seafood"></td>
    <td><img src="images/icon/carrot.PNG" width="95" height="95" id="vegetables"></td>
    <td><img src="images/icon/cake.PNG" width="95" height="95" id="dessert"></td>
    </tr><tr>
    <td><img src="images/icon/soup.PNG" width="95" height="95" id="soup"></td>
    <td><img src="images/icon/mee.PNG" width="95" height="95" id="noodles"></td>
    <td><img src="images/icon/special.PNG" width="95" height="95" id="special"></td>
    </tr>
    </table>	
    	
	</div>
    
    <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<a href="#home"> <img src="images/icon/home icon 2.png" width="57" height="57"> </a>
  	</td>  
  	<td align="center">
  	<a href="#profile"> <img src="images/icon/Contact-icon 2.png" width="57" height="57"> </a>
 	</td>
  	<td align="center">
  	<a href="#"> <img src="images/icon/food_dining_icon.png" width="57" height="57"> </a>
  	</td>
  	<td align="center"> 
    <a href="#explore"> <img src="images/icon/search button 2.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div>
    
</div>


<!--- End of tips page --->

<!--- Start of tips2 page --->

<div data-role="page" id="tips2">
	
    <div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"><h2 id="viewcategory"> </h2> </td> </tr>
    </table>
    </div>
    
    
    <div data-role="content" align="center">
    <table id="allthetips" width="305"></table>
    <div id="no_tips"></div>
	</div>
    
    <div id="slider"> 
      <div class="handle">
      	<span> <img src="images/icon/add icon.png" width="46" height="44"> </span>
      </div>
      <h3> Add New Tips <br/></h3>
      
      <div align="center">
      	
        <div data-role="collapsible-set" style="width: 250px;">
        	<div data-role="collapsible" style="width: 250px;">
          			<h4>Category</h4>
          			<p>          
          			<div data-role="fieldcontain">
            		<fieldset data-role="controlgroup" style="width: 250px;">
                    <input type="radio" name="category" id="none" value="None" checked />
              		<label for="none">None</label>
              		<input type="radio" name="category" id="category_0" value="Beef" />
              		<label for="category_0">Beef</label>
              		<input type="radio" name="category" id="category_1" value="Chicken" />
              		<label for="category_1">Chicken</label>
              		<input type="radio" name="category" id="category_2" value="Fish" />
              		<label for="category_2">Fish</label>
              		<input type="radio" name="category" id="category_3" value="Seafood" />
              		<label for="category_3">Seafood</label>
              		<input type="radio" name="category" id="category_4" value="Vegetables" />
              		<label for="category_4">Vegetables</label>
              		<input type="radio" name="category" id="category_5" value="Dessert" />
              		<label for="category_5">Dessert</label>
              		<input type="radio" name="category" id="category_6" value="Soup" />
              		<label for="category_6">Soup</label>
              		<input type="radio" name="category" id="category_7" value="Noodles" />
              		<label for="category_7">Noodles</label>
              		<input type="radio" name="category" id="category_8" value="Special" />
              		<label for="category_8">Special</label>
            		</fieldset>
          			</div>
          			</p>
          	</div>
      	</div>
        
      <div data-role="fieldcontain">
      <input type="text" placeholder="title" id="tips_title" style="width: 230px;">
      </div>
      
      <div data-role="fieldcontain">
      <textarea id="tips_content" style="width: 250px; height: 150px; max-width: 250px; max-height: 150px;" placeholder="Write your tips here"></textarea>
      </div>
      
      <div data-role="fieldcontain">
      <input type="button" id="submit_tips" value="Submit" style="width: 250px;">
      </div>
      
     </div>
    </div>
    
    <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<a href="#home"> <img src="images/icon/home icon 2.png" width="57" height="57"> </a>
  	</td>  
  	<td align="center">
  	<a href="#profile"> <img src="images/icon/Contact-icon 2.png" width="57" height="57"> </a>
 	</td>
  	<td align="center">
  	<a href="#"> <img src="images/icon/food_dining_icon.png" width="57" height="57"> </a>
  	</td>
  	<td align="center"> 
    <a href="#explore"> <img src="images/icon/search button 2.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div>
    
</div>


<!--- End of tips2 page --->

<!--- Start of home page --->

<div data-role="page" id="home">
	
    <div data-role="header">
    <table>
    <tr> <td rowspan="2"> <img src="images/icon/Final logo DeliCook.JPG" width="71" height="68"> </td> 
    </tr>
    <tr> <td rowspan="2"><h2> What's new for today? </h2> </td> </tr>
    </table>
    <img src="images/icon/logout icon 4.png" width="46" height="44"class="ui-btn-right" onClick="logOutSession()">
    </div>
    
    
    <div data-role="content" align="center">	
    <table id="homerecipes" align="center">
    </table>	
	</div>
    
    <div id="panel" class="panel"> 
  	<table width="100%">
  	<tr>
  	<td align="center">
  	<a href="#"> <img src="images/icon/home icon.png" width="57" height="57"> </a>
  	</td>  
  	<td align="center">
  	<a href="#profile"> <img src="images/icon/Contact-icon 2.png" width="57" height="57"> </a>
 	</td>
  	<td align="center">
  	<a href="#tips"> <img src="images/icon/food_dining_icon 2.png" width="57" height="57"> </a>
  	</td>
  	<td align="center"> 
    <a href="#explore"> <img src="images/icon/search button 2.png" width="57" height="57"> </a>
  	</td>
  	</tr>
  	</table>
  	</div>
    
</div>


<!--- End of home page --->




<script>

//menubar option panel

$("#menu-bar a").click(function(){
          var id = $(this).attr("href").substring(1);
          $("html, body").animate({ scrollTop: $("#"+id).offset().top }, 1000, function(){
            $("#menu-bar").slideReveal("hide");
          });
        });

        var slider = $("#menu-bar").slideReveal({
          // width: 100,
          push: false,
          position: "right",
          // speed: 600,
          trigger: $(".handle"),
          autoEscape: false,
          shown: function(obj){
            obj.find(".handle").html('<span> <img src="images/icon/right arrow.png" width="46" height="44"> </span>');
            obj.addClass("left-shadow-overlay");
          },
          hidden: function(obj){
            obj.find(".handle").html('<span> <img src="images/icon/left arrow.png" width="46" height="44"> </span>');
            obj.removeClass("left-shadow-overlay");
          }
});

$('#slider').slideReveal({
   	      width: 275,
          push: false,
          position: "right",
          // speed: 600,
          trigger: $(".handle"),
          autoEscape: false,
          shown: function(obj){
            obj.find(".handle").html('<span> <img src="images/icon/right arrow.png" width="46" height="44"> </span>');
            obj.addClass("left-shadow-overlay");
          },
          hidden: function(obj){
            obj.find(".handle").html('<span> <img src="images/icon/add icon.png" width="46" height="44"> </span>');
            obj.removeClass("left-shadow-overlay");
          }
});


//sign up event...........

$("#signupbtn").click(function(){
	var email = $("#email").val();
	var password = $("#password").val();
	var username = $("#username").val();
	var cfm_passwd = $("#cfm_password").val();
	var created = $.now();
	var NULL = "";
	
	if ((email != NULL) && (username != NULL) && (password != NULL) && (cfm_passwd != NULL)) {
			if(password == cfm_passwd){
					function populateDB(tx){
						tx.executeSql('CREATE TABLE IF NOT EXISTS user(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, created unique, email, username UNIQUE, password)');
						tx.executeSql('INSERT INTO user(created, email, username, password) VALUES(?, ?, ?, ?)', [created, email, username, password]);
					}
					function errorCB(err){
						alert("error");
					}
		
					function successCB(){
						$.mobile.changePage( $("#signup2"), "slide", true, true);
					}
				
					var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
					db.transaction(populateDB,errorCB,successCB);
		
				}
		 			else {
						swal("Invalid input!", "Wrong password confirmation!", "warning") }
		 		}
					else {
						swal("Invalid input!", "Please fill up all the fields!", "warning") }
				
		
			$("#uploadprofilepic").click(function(){
			var profilepic =  $('#profilepic').attr('src');
		
			function populateDB(tx){
				tx.executeSql('CREATE TABLE IF NOT EXISTS userimage(username PRIMARY KEY, image)');
				tx.executeSql('INSERT INTO userimage(image,username) VALUES(?,?)', [profilepic, username]);
			}
		
			function errorCB(err){
				alert("error");
			}
			function successCB(){
				swal("Welcome!", "You are now a part of Delicook community! You may start by logging in!", "success")
				$.mobile.changePage( $("#login"), "slide", true, true);
			}
		
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
			db.transaction(populateDB,errorCB,successCB);
		
});
		
		
});

//login event.........

$("#loginbtn").click(function(){
	var username = $("#loginusername").val();
	var password = $("#loginpassword").val();
	var NULL = "";
	
	localStorage.setItem("username", username);

	if ((username != NULL) && (password != NULL)) {
		
		$('document').ready(function(){
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM user WHERE username=? and password=?', [username,password], querySuccess, errorCB);
			});
			
			function querySuccess(tx, results){
				var len = results.rows.length;
					if(len > 0){
						$.mobile.changePage( $("#profile"), "slide", true, true);
						window.location.reload();
						  }
				else {
					swal("Invalid input!", "Wrong username or password", "warning") }
			}
		
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});
	}
	else { swal("Invalid input!", "Please fill up all the fields!", "warning") }
	
});

//displaying the profile image
	
$('document').ready(function(){
			var username = localStorage.getItem('username');
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM userimage WHERE username=?', [username], querySuccess, errorCB);
			});
			
			function querySuccess(tx, results){
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						var url = results.rows.item(i).image;
						$('#pic').attr('src', url);
						$("#p_usrname").append("<h2>"+results.rows.item(i).username)+"</h2>";
					}
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});

//adding new recipe

function addnew(){
	var username = localStorage.getItem('username');
	$.mobile.changePage( $("#addrecipe"), "slide", true, true);
	swal({  title: "New recipe",
			text: "Recipe name:",   
			type: "input",   showCancelButton: true,   
			closeOnConfirm: false,   animation: "slide-from-top",   
			inputPlaceholder: "Your recipe name" }, 
			
			function(inputValue){   
				if (inputValue === false) return false;      
					if (inputValue === "") {     
					swal.showInputError("Your recipe must have a name");     
					return false   }      
					swal("Nice!", "Your new recipe is " + inputValue, "success");
					$("#title").append("<h2>"+inputValue+"</h2>");
					
					$("#addrecipebutton").click(function(){
						var recipe = $("#recipe").val();
						var recipe_img =  $('#recipeimg').attr('src');
						
						var d = new Date();
						var hours = d.getHours();
						var suffix = hours >= 12 ? "PM":"AM"; 
						var minutes = d.getMinutes();
						var month = d.getMonth();
						
						month = month+1;
						minutes = minutes > 9 ? minutes : '0' + minutes;
						hours = ((hours + 11) % 12 + 1)+":"+ minutes+" "+ suffix;
						
						var timestamp = d.getDate()+"/"+ month +"/"+d.getFullYear()+" . "+hours;
						var NULL = "";
							if (recipe != NULL) {
								function populateDB(tx){
									tx.executeSql('CREATE TABLE IF NOT EXISTS recipes(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, username, title, recipe, recipe_img, timestamp)');
									tx.executeSql('INSERT INTO recipes(username, title, recipe, recipe_img, timestamp) VALUES(?, ?, ?, ?, ?)', [username, inputValue, recipe, recipe_img, timestamp]);
					}
					function errorCB(err){
						alert("error");
					}
		
					function successCB(){
						swal({   
								title: "Sweet!",   
								text: "Thanks for sharing us your recipe",   
								imageUrl: "images/thumbs-up.jpg",     
								confirmButtonColor: "#FF6820",   
								confirmButtonText: "OK",   
								closeOnConfirm: false }, 
								
								function(){   
								$.mobile.changePage( $("#profile"), "slide", true, true); 
								window.location.reload(); });
						
						
					}
					
				
					var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
					db.transaction(populateDB,errorCB,successCB);
		
				}
				else {
						swal("Invalid input!", "Please fill up all the fields!", "warning") }
					
		
});
					
	});
}


//diplaying all uploaded recipes

$('document').ready(function(){
			var username = localStorage.getItem('username');
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM recipes WHERE username=?', [username], querySuccess, errorCB);
			});
			
			function querySuccess(tx, results){
				var len = results.rows.length;
				if(len > 0){
					$("#totalrecipe").append(len);
					for(i = 0; i < len; i++){
						$("#alltherecipes").append("<img onClick='ViewRecipe(this)' src='"+results.rows.item(i).recipe_img+"' height='160px' width='160px'>");
					}
				}
				else {
					$("#totalrecipe").append(len);
					$("#norecipes").append("<br><br><font color=#A4A4A4> No recipes uploaded yet. </font>");
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});
		
//diplaying all in homepage

$('document').ready(function(){
			var username = localStorage.getItem('username');
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM recipes', [], querySuccess, errorCB);
			});
			
			function querySuccess(tx, results){
				var len = results.rows.length;
				var loop = len-1;
				if(len > 0){
					for(i = loop; i >= 0; i--){
						var viewuser = results.rows.item(i).username;
						var viewtitle = results.rows.item(i).title;
						var viewimage = results.rows.item(i).recipe_img;
						var viewtimestamp = results.rows.item(i).timestamp;
						
						localStorage.setItem("viewuser", viewuser);
						localStorage.setItem("viewtitle", viewtitle);
						localStorage.setItem("viewimage", viewimage);
						localStorage.setItem("viewtimestamp", viewtimestamp);
						
						ViewHome();
					}
				}
				else {
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});
		
//Append all recipe to homepage

function ViewHome() {
	var viewuser = localStorage.getItem('viewuser');
	var viewtitle = localStorage.getItem('viewtitle');
	var viewimage = localStorage.getItem('viewimage');
	var viewtimestamp = localStorage.getItem('viewtimestamp');
	
	db.transaction(function(tx){
				tx.executeSql('SELECT * FROM userimage WHERE username=?', [viewuser], querySuccess, errorCB);
			});
	
	function querySuccess(tx, results){
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						$("#homerecipes").append("<tr><td><img src='"+results.rows.item(i).image+"' width='71' height='68' onClick='ViewUser(this)'></td><td align='left' width='215'><h2>"+viewuser+"</h2></td></tr><tr><td colspan='2'><img onClick='ViewUserHomeRecipe(this)' src='"+viewimage+"' height='250' width='305'><br><font size='+2'>"+viewtitle+"</font></td></tr><tr><td colspan='2'><font size='-1'>"+viewtimestamp+"</font><br><font color='#BDBDBD'>_____________________________________________</font><p>&nbsp;</p></td></tr>");
						
					}
				}
				else {
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}

}
//view full recipe
		
function ViewRecipe(image) {
	
	var username = localStorage.getItem('username');
	var url = image.src;
	
	var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
	db.transaction(function(tx){
				tx.executeSql('SELECT * FROM recipes WHERE username=? AND recipe_img=?', [username,url], querySuccess, errorCB);
			});
	
	$.mobile.changePage( $("#viewrecipe"), "slide", true, true);
	
	function querySuccess(tx, results){
				
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						document.getElementById("recipe_title2").innerHTML = results.rows.item(i).title;
						document.getElementById("cook").innerHTML = " by "+results.rows.item(i).username;
						$('#recipeimg2').attr('src', url);
						document.getElementById("recipe2").innerHTML = results.rows.item(i).recipe;
						
					}
				}
				else{
					
				}
	}
			
	function errorCB(err){
		 		alert("Error" + err.code);	}

}

//displaying all users
	
$('document').ready(function(){
			var username = localStorage.getItem('username');
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM userimage', [], querySuccess, errorCB);
			});
			
			
			function querySuccess(tx, results){
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						var current_user = results.rows.item(i).username;
						if( current_user != username ) {
						$("#alltheusers").append("<tr><td><img onClick='ViewUser(this)' src='"+results.rows.item(i).image+"' height='70px' width='70px'></td><td width='100' align='center'><h2>"+results.rows.item(i).username+"</h2></td><td width='100' align='right'><a href='#' data-role='button' data-icon='plus' data-iconpos='notext'>Button</a></td></tr>"); }
					}
				
				}
				else {
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});

	
//view user profile
		
function ViewUser(image) {
	
	/*$('.users').click(function(e) {
    var index = $('.users').index(this) + 1;
    
    var obj = {
        index: index
    };
    
    window.history.pushState(obj, $(this).text(), "/" + index);
    
    e.preventDefault();
	});
	
	
	$(window).bind("popstate", function(e) {
    	var state = e.originalEvent.state;
    
    	if(state) {
        	window.location.reload();
    	} else {
        	//window.location.reload();
    }
	});*/
	
	var url = image.src;
	
	var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
	db.transaction(function(tx){
				tx.executeSql('SELECT * FROM userimage WHERE image=?', [url], querySuccess, errorCB);
			});
	
	function querySuccess(tx, results){
				
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						var current_user = results.rows.item(i).username;
						localStorage.setItem("current_user", current_user);
						localStorage.setItem("current_userimg", url);
						$.mobile.changePage( $("#viewuser"), "slide", true, true);
						window.location.reload();
					}
				}
	}
			
	function errorCB(err){
		 		alert("Error" + err.code);	}
				
}

//view all recipes for current user viewed

$('document').ready(function(){
	
	var view_current_user = localStorage.getItem('current_user');
	var url = localStorage.getItem('current_userimg');
	$('#viewuserimage').attr('src', url);

db.transaction(function(tx){
		tx.executeSql('SELECT * FROM recipes WHERE username=?', [view_current_user], querySuccess2, errorCB2);
		});
			
function querySuccess2(tx, results){
	var len = results.rows.length;
	if(len > 0){
		document.getElementById("viewusername").innerHTML = view_current_user
		document.getElementById("totalrecipe2").innerHTML = len
		for(i = 0; i < len; i++){
		$("#viewalluserrecipes").append("<img onClick='ViewUserRecipe(this)' src='"+results.rows.item(i).recipe_img+"' height='160px' width='160px'>");
		}
	}
	else {
		document.getElementById("totalrecipe2").innerHTML = len
		document.getElementById("user_norecipes").innerHTML = "<br><br><font color=#A4A4A4> No recipes uploaded yet. </font>"
	}
}
			
function errorCB2(err){
		alert("Error" + err.code);	}
				
});

//view user full recipe
		
function ViewUserRecipe(image) {
	
	var username = localStorage.getItem('current_user');
	var url = image.src;
	
	var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
	db.transaction(function(tx){
				tx.executeSql('SELECT * FROM recipes WHERE username=? AND recipe_img=?', [username,url], querySuccess, errorCB);
			});
	
	$.mobile.changePage( $("#viewrecipe"), "slide", true, true);
	
	function querySuccess(tx, results){
				
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						document.getElementById("recipe_title2").innerHTML = results.rows.item(i).title;
						document.getElementById("cook").innerHTML = " by "+results.rows.item(i).username;
						$('#recipeimg2').attr('src', url);
						document.getElementById("recipe2").innerHTML = results.rows.item(i).recipe;
						
					}
				}
				else{
					
				}
	}
			
	function errorCB(err){
		 		alert("Error" + err.code);	}

}

//view user full recipe from home page click
		
function ViewUserHomeRecipe(image) {
	
	var url = image.src;
	//var username = localStorage.getItem('viewuser');
	
	var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
	db.transaction(function(tx){
				tx.executeSql('SELECT * FROM recipes WHERE recipe_img=?', [url], querySuccess, errorCB);
			});
	
	$.mobile.changePage( $("#viewrecipe"), "slide", true, true);
	
	function querySuccess(tx, results){
				
				var len = results.rows.length;
				if(len > 0){
					for(i = 0; i < len; i++){
						document.getElementById("recipe_title2").innerHTML = results.rows.item(i).title;
						document.getElementById("cook").innerHTML = " by "+results.rows.item(i).username;
						$('#recipeimg2').attr('src', url);
						document.getElementById("recipe2").innerHTML = results.rows.item(i).recipe;
						
					}
				}
				else{
					
				}
	}
			
	function errorCB(err){
		 		alert("Error" + err.code);	}

}

//submit tips event...........

$("#submit_tips").click(function(){
	var username = localStorage.getItem('username');
	var tips_title = $("#tips_title").val();
	var tips_content = $("#tips_content").val();
	var category = document.querySelector('input[name="category"]:checked').value;
	var NULL = "";
	
	var d = new Date();
						var hours = d.getHours();
						var suffix = hours >= 12 ? "PM":"AM"; 
						var minutes = d.getMinutes();
						var month = d.getMonth();
						
						month = month+1;
						minutes = minutes > 9 ? minutes : '0' + minutes;
						hours = ((hours + 11) % 12 + 1)+":"+ minutes+" "+ suffix;
						
	var timestamp = d.getDate()+"/"+ month +"/"+d.getFullYear()+" . "+hours;
	
	
	if ((tips_title != NULL) && (tips_content != NULL)) {
		if(category != "None"){
					function populateDB(tx){
						tx.executeSql('CREATE TABLE IF NOT EXISTS tips(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, username, title, content, timestamp, category)');
						tx.executeSql('INSERT INTO tips(username, title, content, timestamp, category) VALUES(?, ?, ?, ?, ?)', [ username, tips_title, tips_content, timestamp, category]);
					}
					function errorCB(err){
						alert("error");
					}
		
					function successCB(){
						localStorage.setItem("selected_category", category);
						
						swal({   
								title: "Wow!",   
								text: "Thanks for sharing us your tips",   
								imageUrl: "images/thumbs-up.jpg",     
								confirmButtonColor: "#FF6820",   
								confirmButtonText: "OK",   
								closeOnConfirm: false }, 
								
								function(){   
								window.location.reload(); });
					
					}
				
					var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
					db.transaction(populateDB,errorCB,successCB);
		
				}
		 			else {
						swal("Invalid input!", "Please choose a category!", "error") }
		 		}
					else {
						swal("Invalid input!", "Please fill up all the fields!", "error") }
				
});

//diplaying tips

$("#beef").click(function(){
	localStorage.setItem("selected_category", "Beef");
	$.mobile.changePage( $("#tips2"), "slide", true, true);
	window.location.reload();
	
});

$("#chicken").click(function(){
	localStorage.setItem("selected_category", "Chicken");
	$.mobile.changePage( $("#tips2"), "slide", true, true);
	window.location.reload();
});

$("#fish").click(function(){
	localStorage.setItem("selected_category", "Fish");
	$.mobile.changePage( $("#tips2"), "slide", true, true);
	window.location.reload();
});

$("#seafood").click(function(){
	localStorage.setItem("selected_category", "Seafood");
	$.mobile.changePage( $("#tips2"), "slide", true, true);
	window.location.reload();
});

$("#vegetables").click(function(){
	localStorage.setItem("selected_category", "Vegetables");
	$.mobile.changePage( $("#tips2"), "slide", true, true);
	window.location.reload();
});

$("#dessert").click(function(){
	localStorage.setItem("selected_category", "Dessert");
	$.mobile.changePage( $("#tips2"), "slide", true, true);
	window.location.reload();
});

$("#soup").click(function(){
	localStorage.setItem("selected_category", "Soup");
	$.mobile.changePage( $("#tips2"), "slide", true, true);
	window.location.reload();
});

$("#noodles").click(function(){
	localStorage.setItem("selected_category", "Noodles");
	$.mobile.changePage( $("#tips2"), "slide", true, true);
	window.location.reload();
});

$("#special").click(function(){
	localStorage.setItem("selected_category", "Special");
	$.mobile.changePage( $("#tips2"), "slide", true, true);
	window.location.reload();
});

$('document').ready(function(){
			var category = localStorage.getItem('selected_category');
			var db = openDatabase('delicook', '1', 'delicook', 2 * 1024 * 1024);
	    	
			db.transaction(function(tx){
				tx.executeSql('SELECT * FROM tips WHERE category=?', [category], querySuccess, errorCB);
			});
			
			function querySuccess(tx, results){
				var len = results.rows.length;
				var loop = len-1;
				if(len > 0){
					for(i = loop; i >= 0; i--){
						var tips_username = results.rows.item(i).username;
						var tips_title = results.rows.item(i).title;
						var tips_content = results.rows.item(i).content;
						var tips_category = results.rows.item(i).category;
						var tips_timestamp = results.rows.item(i).timestamp;
						
						localStorage.setItem("tips_username", tips_username);
						localStorage.setItem("tips_title", tips_title);
						localStorage.setItem("tips_content", tips_content);
						localStorage.setItem("tips_category", tips_category);
						localStorage.setItem("tips_timestamp", tips_timestamp);
						
						ViewTips();
					}
				}
				else {
					document.getElementById("no_tips").innerHTML = "<br><br><font color=#A4A4A4> No tips uploaded yet. Be the first one to post! </font>";
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}
		});
		

		
function ViewTips() {
	var tips_username = localStorage.getItem('tips_username');
	var tips_title = localStorage.getItem('tips_title');
	var tips_content = localStorage.getItem('tips_content');
	var tips_category = localStorage.getItem('tips_category');
	var tips_timestamp = localStorage.getItem('tips_timestamp');
	
	
	db.transaction(function(tx){
				tx.executeSql('SELECT * FROM userimage WHERE username=?', [tips_username], querySuccess, errorCB);
			});
	
	function querySuccess(tx, results){
				var len = results.rows.length;
				if(len > 0){
					document.getElementById("viewcategory").innerHTML = tips_category;
					for(i = 0; i < len; i++){
						$("#allthetips").append("<tr><td><img src='"+results.rows.item(i).image+"' width='71' height='68' onClick='ViewUser(this)'></td><td align='left' width='215'><h2>"+tips_username+"</h2></td></tr><tr><td colspan='2'><font size='+2'>"+tips_title+"</font><br>"+tips_content+"</td></tr><tr><td colspan='2'><font size='-1'>"+tips_timestamp+"</font><br><font color='#BDBDBD'>_____________________________________________</font><p>&nbsp;</p></td></tr>");
						
					}
				}
				else {
					
					document.getElementById("no_tips").innerHTML = "<br><br><font color=#A4A4A4> No tips uploaded yet. </font>"
					
				}
		}
			function errorCB(err){
		 		alert("Error" + err.code);	}

}


</script>


</body>
</html>
